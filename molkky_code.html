<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Molkky Repro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1f2937; color: white; font-family: sans-serif; touch-action: manipulation; }
        
        /* ç”»é¢ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆç”¨ã‚¯ãƒ©ã‚¹ */
        .view-section { display: none; height: 100vh; flex-direction: column; }
        .active-view { display: flex; }

        /* ã‚¹ã‚­ãƒƒãƒˆãƒ«ãƒœã‚¿ãƒ³ï¼ˆæœ¨ã®è³ªæ„Ÿï¼‰ */
        .pin-btn {
            width: 58px; height: 58px;
            border-radius: 50%;
            background-color: #d4a373; color: #3e2723;
            font-size: 1.4rem; font-weight: bold;
            display: flex; align-items: center; justify-center: center;
            box-shadow: 0 4px 0 #8d6e63;
            transition: all 0.1s;
        }
        .pin-btn:active { transform: translateY(4px); box-shadow: none; }

        /* ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¼·èª¿è¡¨ç¤º */
        .current-turn { border: 2px solid #fbbf24; background-color: #374151; }
    </style>
</head>
<body class="max-w-md mx-auto bg-gray-900 shadow-2xl overflow-hidden">

    <div id="view-title" class="view-section active-view justify-center items-center p-6 text-center space-y-8">
        <div>
            <h1 class="text-5xl font-bold text-green-500 mb-2">MÃ¶lkky<br>Note</h1>
            <p class="text-gray-400 text-sm">Simple Score Logger</p>
        </div>
        <button onclick="goToSetup()" class="w-full py-4 bg-green-600 text-white rounded-xl font-bold text-xl shadow-lg hover:bg-green-500 transition">
            æ–°ã—ã„è©¦åˆ
        </button>
        <div class="text-xs text-gray-600 mt-8">Ver 1.0 (GitHub Pages)</div>
    </div>

    <div id="view-setup" class="view-section p-6">
        <h2 class="text-xl font-bold text-center mb-6 border-b border-gray-700 pb-2">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ</h2>
        
        <div class="flex-grow overflow-y-auto space-y-3 mb-4" id="player-input-list">
            <input type="text" value="Player 1" class="player-name-input w-full p-3 bg-gray-800 rounded border border-gray-600 text-white">
            <input type="text" value="Player 2" class="player-name-input w-full p-3 bg-gray-800 rounded border border-gray-600 text-white">
        </div>

        <button onclick="addPlayerInput()" class="w-full py-2 mb-4 bg-gray-700 text-gray-300 rounded-lg text-sm border-dashed border-2 border-gray-600">+ ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ </button>

        <button onclick="startGame()" class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold text-lg shadow-lg">
            è©¦åˆé–‹å§‹
        </button>
        <button onclick="showView('view-title')" class="mt-4 text-gray-500 text-sm text-center w-full">æˆ»ã‚‹</button>
    </div>

    <div id="view-game" class="view-section">
        <div class="bg-gray-800 p-2 flex-grow overflow-y-auto">
            <table class="w-full text-left">
                <thead class="text-xs text-gray-500 border-b border-gray-700">
                    <tr>
                        <th class="pb-1 pl-2">NAME</th>
                        <th class="pb-1 text-center">MISS</th>
                        <th class="pb-1 text-right pr-4">SCORE</th>
                    </tr>
                </thead>
                <tbody id="scoreboard-body" class="text-sm">
                    </tbody>
            </table>
        </div>

        <div class="bg-gray-900 p-4 pb-8 rounded-t-3xl shadow-[0_-5px_15px_rgba(0,0,0,0.5)] z-10">
            <div class="flex justify-between items-center mb-4 px-2">
                <div>
                    <span class="text-xs text-green-400 block">THROWING NEXT</span>
                    <span id="current-player-name" class="text-xl font-bold text-white">Player Name</span>
                </div>
                <div class="text-right">
                    <span class="text-xs text-gray-400 block">TARGET</span>
                    <span class="text-2xl font-mono text-yellow-400">50</span>
                </div>
            </div>

            <div class="flex flex-col items-center gap-3 mb-4">
                <div class="flex gap-4"> <button class="pin-btn" onclick="inputScore(7)">7</button>
                    <button class="pin-btn" onclick="inputScore(9)">9</button>
                    <button class="pin-btn" onclick="inputScore(8)">8</button>
                </div>
                <div class="flex gap-4"> <button class="pin-btn" onclick="inputScore(5)">5</button>
                    <button class="pin-btn" onclick="inputScore(11)">11</button>
                    <button class="pin-btn" onclick="inputScore(12)">12</button>
                    <button class="pin-btn" onclick="inputScore(6)">6</button>
                </div>
                <div class="flex gap-4"> <button class="pin-btn" onclick="inputScore(3)">3</button>
                    <button class="pin-btn" onclick="inputScore(10)">10</button>
                    <button class="pin-btn" onclick="inputScore(4)">4</button>
                </div>
                <div class="flex gap-4"> <button class="pin-btn" onclick="inputScore(1)">1</button>
                    <button class="pin-btn" onclick="inputScore(2)">2</button>
                </div>
            </div>

            <button onclick="inputScore(0)" class="w-full py-3 bg-red-900/80 text-red-200 font-bold rounded-xl border border-red-800 active:bg-red-800">
                MISS (0ç‚¹)
            </button>
        </div>
    </div>

    <div id="view-result" class="view-section justify-center items-center p-6 text-center">
        <div class="text-6xl mb-4">ğŸ‘‘</div>
        <h2 class="text-2xl text-yellow-400 font-bold mb-2">WINNER!</h2>
        <div id="winner-name" class="text-4xl font-bold text-white mb-8">Player Name</div>
        
        <button onclick="showView('view-title')" class="w-full py-4 bg-gray-700 text-white rounded-xl font-bold">
            ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹
        </button>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        let players = []; // { name: "A", score: 0, miss: 0 }
        let currentIndex = 0; // ä»Šèª°ã®ç•ªã‹

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.getElementById(viewId).classList.add('active-view');
        }

        // --- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ã®å‡¦ç† ---
        function goToSetup() {
            showView('view-setup');
        }

        function addPlayerInput() {
            const list = document.getElementById('player-input-list');
            const count = list.children.length + 1;
            const input = document.createElement('input');
            input.type = "text";
            input.value = "Player " + count;
            input.className = "player-name-input w-full p-3 bg-gray-800 rounded border border-gray-600 text-white mt-2";
            list.appendChild(input);
        }

        // --- è©¦åˆé–‹å§‹å‡¦ç† ---
        function startGame() {
            // å…¥åŠ›ã•ã‚ŒãŸåå‰ã‚’å–å¾—
            const inputs = document.querySelectorAll('.player-name-input');
            players = [];
            inputs.forEach(input => {
                if(input.value.trim() !== ""){
                    players.push({ name: input.value, score: 0, miss: 0, history: [] });
                }
            });

            if(players.length === 0) { alert("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã¾ã›ã‚“"); return; }

            currentIndex = 0;
            updateScoreboard();
            showView('view-game');
        }

        // --- ã‚¹ã‚³ã‚¢å…¥åŠ›å‡¦ç† ---
        function inputScore(points) {
            const player = players[currentIndex];
            const prevScore = player.score;

            // ãƒŸã‚¹å‡¦ç†
            if(points === 0) {
                player.miss += 1;
                player.history.push(0);
                if(player.miss >= 3) {
                    alert(player.name + "ã•ã‚“ã¯3å›é€£ç¶šãƒŸã‚¹ã§å¤±æ ¼ã§ã™...");
                    player.score = 0; // å¤±æ ¼æ‰±ã„ã®å‡¦ç†ï¼ˆä»Šå›ã¯0ç‚¹ã«ã—ã¦ç¶šè¡Œã•ã›ã‚‹ç°¡æ˜“ç‰ˆï¼‰
                    // æœ¬æ¥ãªã‚‰ã‚²ãƒ¼ãƒ ã‹ã‚‰é™¤å¤–ã™ã‚‹å‡¦ç†ãªã©ãŒå…¥ã‚‹
                    player.miss = 0; // ãƒªã‚»ãƒƒãƒˆ
                }
            } else {
                player.miss = 0; // ç‚¹æ•°ãŒå…¥ã‚Œã°ãƒŸã‚¹ãƒªã‚»ãƒƒãƒˆ
                let nextScore = player.score + points;
                
                if(nextScore === 50) {
                    player.score = 50;
                    endGame(player.name);
                    return;
                } else if(nextScore > 50) {
                    alert("ã‚ªãƒ¼ãƒãƒ¼ï¼25ç‚¹ã«æˆ»ã‚Šã¾ã™ã€‚");
                    player.score = 25;
                } else {
                    player.score = nextScore;
                }
                player.history.push(points);
            }

            // æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ï¼ˆå…¨å“¡å¤±æ ¼ã—ã¦ã„ãªã„å‰æã®ç°¡æ˜“ãƒ«ãƒ¼ãƒ—ï¼‰
            currentIndex = (currentIndex + 1) % players.length;
            
            updateScoreboard();
        }

        // --- ç”»é¢æ›´æ–° ---
        function updateScoreboard() {
            const tbody = document.getElementById('scoreboard-body');
            tbody.innerHTML = "";

            players.forEach((p, index) => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-700 " + (index === currentIndex ? "bg-gray-700" : "");
                
                // ãƒŸã‚¹è¡¨ç¤ºï¼ˆâ—â—â—ï¼‰
                let missHtml = "";
                for(let i=0; i<3; i++) missHtml += (i < p.miss) ? "âŒ" : "<span class='text-gray-600'>â—</span>";

                tr.innerHTML = `
                    <td class="py-3 pl-2 font-bold ${index === currentIndex ? 'text-green-400' : 'text-gray-300'}">
                        ${p.name}
                        ${index === currentIndex ? '<span class="text-xs ml-1">â—€</span>' : ''}
                    </td>
                    <td class="text-center text-xs tracking-tighter">${missHtml}</td>
                    <td class="text-right pr-4 font-mono text-xl font-bold">${p.score}</td>
                `;
                tbody.appendChild(tr);
            });

            // ä¸‹éƒ¨ãƒ‘ãƒãƒ«ã®åå‰æ›´æ–°
            document.getElementById('current-player-name').innerText = players[currentIndex].name;
        }

        // --- ã‚²ãƒ¼ãƒ çµ‚äº† ---
        function endGame(winnerName) {
            document.getElementById('winner-name').innerText = winnerName;
            showView('view-result');
        }
    </script>
</body>
</html>
