<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M√∂lkky Battle Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
    <style>
        /* ÁîªÈù¢ÂÖ®‰Ωì„ÇíÂõ∫ÂÆö„Åó„ÄÅ„Çπ„ÇØ„É≠„Éº„É´„ÇíÈò≤„Åê */
        body { 
            background-color: #111827; 
            color: white; 
            font-family: 'Roboto', sans-serif; 
            touch-action: manipulation;
            height: 100dvh; /* „Çπ„Éû„Éõ„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„ÉºËÄÉÊÖÆ */
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .view-section { 
            display: none; 
            height: 100%; 
            width: 100%; 
            flex-direction: column; 
        }
        .active-view { display: flex; }

        /* „Éú„Çø„É≥„Éá„Ç∂„Ç§„É≥Ë™øÊï¥ÔºàÂ∞ë„ÅóÂ∞è„Åï„Åè„Åó„Å¶ÁîªÈù¢„Å´Âèé„ÇÅ„ÇãÔºâ */
        .score-btn {
            width: 100%; aspect-ratio: 1; /* Ê≠£ÊñπÂΩ¢Á∂≠ÊåÅ */
            max-width: 60px; max-height: 60px;
            font-size: 1.6rem; font-weight: 900;
            display: flex; align-items: center; justify-content: center; padding: 0;
            transition: all 0.1s; position: relative;
        }
        .score-btn:active { transform: scale(0.92); }

        .btn-snipe { border-radius: 50%; background: linear-gradient(135deg, #e4c49f 0%, #c89f72 100%); color: #3e2723; border: 2px solid #5d4037; box-shadow: 0 3px 0 #8d6e63; }
        .btn-break { border-radius: 12px; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: #ffffff; border: 1px solid #93c5fd; box-shadow: 0 3px 0 #1d4ed8; }
        .btn-miss { background: linear-gradient(to bottom, #ef4444, #dc2626); box-shadow: 0 3px 0 #991b1b; }
        .btn-miss:active { transform: translateY(2px); box-shadow: 0 1px 0 #991b1b; }

        .current-turn { background: rgba(251, 191, 36, 0.15); border-left: 4px solid #fbbf24; }
        .row-eliminated { opacity: 0.4; filter: grayscale(100%); }
        .row-cleared { background: rgba(16, 185, 129, 0.15); border-left: 4px solid #10b981; }

        /* „É¢„Éº„ÉÄ„É´ */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-center: center;
            z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.2s; backdrop-filter: blur(4px);
        }
        .modal-active { opacity: 1; pointer-events: auto; }
        .modal-content { background: #1f2937; border-radius: 20px; padding: 1.5rem; width: 90%; max-width: 320px; text-align: center; border: 1px solid #374151; transform: scale(0.95); transition: transform 0.2s; }
        .modal-active .modal-content { transform: scale(1); }

        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„ÉºË£ÖÈ£æ */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>
<body class="max-w-md mx-auto relative shadow-2xl">

    <button onclick="goHome()" class="fixed top-3 left-3 z-50 w-10 h-10 bg-gray-800/90 backdrop-blur rounded-full flex items-center justify-center shadow-lg border border-gray-600 hover:bg-gray-700 active:scale-95">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
        </svg>
    </button>

    <div id="view-title" class="view-section active-view justify-center items-center p-6 bg-gray-900">
        <div class="mb-8 text-center">
            <h1 class="text-6xl font-black text-yellow-500 mb-2 tracking-tighter drop-shadow-lg leading-none">M√∂lkky<br>Battle</h1>
            <p class="text-gray-400 text-sm font-bold tracking-widest uppercase">Offical Log App</p>
        </div>

        <div class="w-full space-y-4">
            <button onclick="goToSetup()" class="w-full py-5 bg-yellow-600 text-white rounded-2xl font-bold text-2xl shadow-lg hover:bg-yellow-500 transition transform hover:-translate-y-1 flex items-center justify-center">
                <span class="mr-3">üî•</span> Êñ∞„Åó„ÅÑË©¶Âêà
            </button>
            <button onclick="goToRecords()" class="w-full py-5 bg-gray-800 text-gray-300 rounded-2xl font-bold text-xl shadow-lg hover:bg-gray-700 transition transform hover:-translate-y-1 flex items-center justify-center border border-gray-700">
                <span class="mr-3">üìä</span> Ë®òÈå≤„ÇíË¶ã„Çã
            </button>
        </div>
        <div class="mt-8 text-xs text-gray-600">Ver 2.0 (Local Storage)</div>
    </div>

    <div id="view-setup" class="view-section p-4 bg-gray-900">
        <div class="pt-12 pb-4 text-center">
            <h2 class="text-xl font-bold text-white tracking-widest border-b-2 border-yellow-600 inline-block pb-1">PLAYER ENTRY</h2>
        </div>
        <div class="flex-grow overflow-y-auto space-y-3 px-2 custom-scrollbar" id="player-input-list">
            </div>
        <div class="mt-4 space-y-3">
            <button onclick="addPlayerInput()" class="w-full py-3 bg-gray-800 text-gray-400 rounded-xl text-sm border-dashed border-2 border-gray-700 font-bold hover:bg-gray-750">+ „É°„É≥„Éê„ÉºËøΩÂä†</button>
            <button onclick="startGame()" class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold text-xl shadow-lg hover:bg-blue-500 transition">GAME START</button>
        </div>
    </div>

    <div id="view-game" class="view-section bg-gray-900">
        <div class="flex-grow overflow-y-auto custom-scrollbar pt-14 px-1 pb-2 bg-gray-800">
            <table class="w-full text-left border-collapse">
                <thead class="text-xs text-gray-500 sticky top-0 bg-gray-800 z-10 shadow-sm">
                    <tr>
                        <th class="pb-2 pl-3 pt-2">NAME</th>
                        <th class="pb-2 text-center pt-2">MISS</th>
                        <th class="pb-2 text-right pr-4 pt-2">SCORE</th>
                    </tr>
                </thead>
                <tbody id="scoreboard-body" class="text-sm font-bold"></tbody>
            </table>
        </div>

        <div class="flex-none bg-gray-900 pb-6 rounded-t-3xl shadow-[0_-4px_20px_rgba(0,0,0,0.5)] z-20 relative px-3">
            
            <div class="flex justify-between items-center px-4 py-3 border-b border-gray-800 mb-2">
                <div class="overflow-hidden">
                    <span class="text-[10px] text-green-400 font-bold tracking-widest block">THROWING NEXT</span>
                    <span id="current-player-name" class="text-xl font-black text-white tracking-tight truncate block">Player</span>
                </div>
                <div class="text-right flex-none pl-4">
                    <span class="text-[10px] text-gray-500 font-bold tracking-widest block">TARGET</span>
                    <span class="text-3xl font-black text-yellow-400 leading-none">50</span>
                </div>
            </div>

            <div class="flex justify-center mb-3">
                <div class="bg-gray-800 p-1 rounded-xl flex w-full max-w-xs border border-gray-700">
                    <button id="tab-snipe" onclick="switchMode('snipe')" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all text-gray-400">üéØ Snipe</button>
                    <button id="tab-break" onclick="switchMode('break')" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all text-gray-400">üí• Break</button>
                </div>
            </div>

            <div class="grid grid-cols-4 gap-2 mb-3 max-w-sm mx-auto">
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(7)">7</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(9)">9</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(8)">8</button></div>
                <div class="row-span-2 flex flex-col gap-2"> <button class="score-btn w-full h-full aspect-auto rounded-xl bg-gray-800 border border-gray-700 text-gray-400 text-sm" onclick="undoLast()">Undo</button>
                </div>

                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(5)">5</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(11)">11</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(12)">12</button></div>
                
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(3)">3</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(10)">10</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(4)">4</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(6)">6</button></div>

                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(1)">1</button></div>
                <div class="flex justify-center"><button class="score-btn" onclick="inputScore(2)">2</button></div>
                <div class="col-span-2"><button onclick="inputScore(0)" class="w-full h-full btn-miss text-white font-black rounded-xl text-lg tracking-wider active:bg-red-700 transition">MISS</button></div>
            </div>
        </div>
    </div>

    <div id="view-result" class="view-section justify-center items-center p-6 text-center bg-gray-900">
        <h2 class="text-4xl text-yellow-400 font-black mb-6 tracking-tighter drop-shadow-md">GAME SET!</h2>
        <div class="w-full bg-gray-800 rounded-2xl p-4 mb-6 text-left space-y-2 shadow-lg border border-gray-700 overflow-y-auto max-h-[50vh]" id="result-list"></div>
        
        <div class="w-full space-y-3">
            <button onclick="restartGame()" class="w-full py-4 bg-green-600 text-white rounded-xl font-bold text-lg hover:bg-green-500 transition shadow-lg flex items-center justify-center">
                <span class="mr-2">üîÑ</span> „ÇÇ„ÅÜ‰∏ÄÂõû (Rematch)
            </button>
            <button onclick="goHome(true)" class="w-full py-4 bg-gray-700 text-white rounded-xl font-bold hover:bg-gray-600 transition border border-gray-600">
                „Çø„Ç§„Éà„É´„Å∏Êàª„Çã
            </button>
        </div>
    </div>

    <div id="view-records" class="view-section p-6 bg-gray-900 pt-20 overflow-y-auto">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-black text-white">STATS LOG</h2>
            <p class="text-xs text-gray-500">Local Storage Data</p>
        </div>
        <div class="mb-6">
            <select id="record-player-select" onchange="analyzeRecords()" class="w-full p-3 bg-gray-800 text-white rounded-xl border border-gray-700 font-bold outline-none focus:border-yellow-500"></select>
        </div>
        <div id="stats-container" class="space-y-6 hidden">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-800 p-4 rounded-xl text-center border border-gray-700">
                    <div class="text-gray-400 text-xs font-bold">Total Throws</div>
                    <div id="stat-total-throws" class="text-3xl font-black text-white mt-1">0</div>
                </div>
                <div class="bg-gray-800 p-4 rounded-xl text-center border border-gray-700">
                    <div class="text-gray-400 text-xs font-bold">50pt Wins</div>
                    <div id="stat-wins" class="text-3xl font-black text-yellow-400 mt-1">0</div>
                </div>
            </div>
            <div class="bg-gray-800 p-5 rounded-xl border border-gray-700">
                <h3 class="text-sm font-bold text-gray-300 mb-4">üéØ Style Ratio</h3>
                <div class="flex justify-between text-xs font-bold mb-1"><span class="text-yellow-500" id="text-snipe">Snipe 0%</span><span class="text-blue-500" id="text-break">Break 0%</span></div>
                <div class="w-full h-3 bg-gray-700 rounded-full flex overflow-hidden"><div id="bar-snipe" class="bg-yellow-500 h-full w-0"></div><div id="bar-break" class="bg-blue-500 h-full w-0"></div></div>
            </div>
        </div>
        <div id="no-data-msg" class="text-center text-gray-500 py-10">Â±•Ê≠¥„Å™„Åó</div>
        <button onclick="clearAllData()" class="w-full mt-8 py-3 bg-red-900/20 text-red-500 border border-red-900 rounded-xl text-xs">Â±•Ê≠¥ÂÖ®Ê∂àÂéª</button>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <div id="modal-icon" class="text-5xl mb-4">‚ö†Ô∏è</div>
            <h3 id="modal-title" class="text-xl font-bold text-white mb-2"></h3>
            <p id="modal-message" class="text-gray-400 text-sm mb-6 leading-relaxed"></p>
            <div id="modal-actions" class="flex gap-3 justify-center"></div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const STATUS = { PLAYING: 'playing', CLEARED: 'cleared', ELIMINATED: 'eliminated' };
        let players = [];
        let currentIndex = 0;
        let clearOrder = [];
        let eliminatedStack = [];
        let currentMode = 'snipe';
        let gameLogs = []; // ‰ªä„ÅÆË©¶Âêà„ÅÆ„É≠„Ç∞

        // --- View Control ---
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.getElementById(viewId).classList.add('active-view');
        }

        // --- Game Setup ---
        function goToSetup() {
            // Ââç„ÅÆ„Éó„É¨„Ç§„É§„ÉºË®≠ÂÆö„Åå„ÅÇ„Çå„Å∞ÊÆã„Åô„Åå„ÄÅ„Å™„Åë„Çå„Å∞„Éá„Éï„Ç©„É´„Éà
            if(document.getElementById('player-input-list').children.length === 0) {
                renderPlayerInputs(['Player 1', 'Player 2', 'Player 3']);
            }
            showView('view-setup');
        }

        function renderPlayerInputs(names) {
            const list = document.getElementById('player-input-list');
            list.innerHTML = '';
            names.forEach(name => {
                const input = document.createElement('input');
                input.value = name;
                input.className = "player-name-input w-full p-4 bg-gray-800 rounded-xl border border-gray-700 text-white font-bold focus:border-yellow-500 outline-none mb-2";
                list.appendChild(input);
            });
        }

        function addPlayerInput() {
            const list = document.getElementById('player-input-list');
            const count = list.children.length + 1;
            const input = document.createElement('input');
            input.value = "Player " + count;
            input.className = "player-name-input w-full p-4 bg-gray-800 rounded-xl border border-gray-700 text-white font-bold focus:border-yellow-500 outline-none mb-2";
            list.appendChild(input);
        }

        function startGame() {
            const inputs = document.querySelectorAll('.player-name-input');
            players = [];
            clearOrder = [];
            eliminatedStack = [];
            gameLogs = [];

            inputs.forEach(input => {
                if(input.value.trim() !== "") {
                    players.push({ name: input.value, score: 0, miss: 0, status: STATUS.PLAYING });
                }
            });

            if(players.length < 1) return alert("„Éó„É¨„Ç§„É§„Éº„Åå„ÅÑ„Åæ„Åõ„Çì");

            currentIndex = 0;
            switchMode('snipe');
            updateScoreboard();
            showView('view-game');
        }

        // --- Game Logic ---
        function switchMode(mode) {
            currentMode = mode;
            if(mode === 'snipe') {
                document.getElementById('tab-snipe').className = "flex-1 py-2 rounded-lg text-xs font-bold bg-yellow-600 text-white shadow-md";
                document.getElementById('tab-break').className = "flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-700";
                document.querySelectorAll('.score-btn').forEach(b => { b.classList.remove('btn-break'); b.classList.add('btn-snipe'); });
            } else {
                document.getElementById('tab-snipe').className = "flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-700";
                document.getElementById('tab-break').className = "flex-1 py-2 rounded-lg text-xs font-bold bg-blue-600 text-white shadow-md";
                document.querySelectorAll('.score-btn').forEach(b => { b.classList.remove('btn-snipe'); b.classList.add('btn-break'); });
            }
        }

        function inputScore(points) {
            const player = players[currentIndex];
            const scoreBefore = player.score;

            // „É≠„Ç∞Ë®òÈå≤
            gameLogs.push({
                player: player.name,
                score_before: scoreBefore,
                points: points,
                mode: points === 0 ? 'miss' : currentMode,
                is_finish: (scoreBefore + points === 50)
            });

            // UndoÁî®„ÅÆ‰ªÆÂÆüË£Ö„Å®„Åó„Å¶„ÄÅ„Åì„Åì„Åß„ÅØstate„ÅÆdeep copy„ÇíÊåÅ„Åü„Å™„ÅÑÁ∞°ÊòìÁâà
            // Êú¨Ê†ºÁöÑ„Å™Undo„ÅØÂ±•Ê≠¥ÁÆ°ÁêÜ„ÅåÂøÖË¶Å„Å†„Åå„ÄÅ‰ªäÂõû„ÅØ„ÄåÊ¨°„Å∏„ÄçÈÄ≤„ÇÄ

            if(points === 0) {
                player.miss++;
                if(player.miss >= 3) {
                    player.status = STATUS.ELIMINATED;
                    eliminatedStack.push(player);
                    showModal('üíÄ', 'Â§±Ê†º', `${player.name}„Åï„Çì„ÅåËÑ±ËêΩ„Åó„Åæ„Åó„Åü`, [{text:'Èñâ„Åò„Çã', onClick: checkGameEnd}]);
                    return; // „É¢„Éº„ÉÄ„É´Èñâ„Åò„Åü„ÇâcheckGameEnd
                }
            } else {
                player.miss = 0;
                let next = player.score + points;
                if(next === 50) {
                    player.score = 50;
                    player.status = STATUS.CLEARED;
                    clearOrder.push(player);
                    showModal('üéâ', 'CLEAR!', `${player.name}„Åï„Çì 50ÁÇπÈÅîÊàêÔºÅ`, [{text:'Ê¨°„Å∏', primary:true, onClick: checkGameEnd}]);
                    return;
                } else if(next > 50) {
                    player.score = 25;
                    showModal('‚Ü©Ô∏è', 'OVER', `${player.name}„Åï„Çì 25ÁÇπ„Å´Êàª„Çä„Åæ„Åô`, [{text:'OK', onClick: checkGameEnd}]);
                    return;
                } else {
                    player.score = next;
                }
            }
            checkGameEnd();
        }

        function checkGameEnd() {
            updateScoreboard();
            const active = players.filter(p => p.status === STATUS.PLAYING);
            if(active.length <= 1) {
                setTimeout(finishGame, 300);
            } else {
                proceedTurn();
            }
        }

        function proceedTurn() {
            let loop = 0;
            do {
                currentIndex = (currentIndex + 1) % players.length;
                loop++;
                if(loop > players.length) break;
            } while (players[currentIndex].status !== STATUS.PLAYING);
            updateScoreboard();
            document.getElementById('current-player-name').innerText = players[currentIndex].name;
        }

        function undoLast() {
            alert("UndoÊ©üËÉΩ„ÅØÊú™ÂÆüË£Ö„Åß„ÅôÔºà‰ªïÊßòË§áÈõëÂåñÈò≤Ê≠¢„ÅÆ„Åü„ÇÅÔºâ");
        }

        function updateScoreboard() {
            const tbody = document.getElementById('scoreboard-body');
            tbody.innerHTML = '';
            players.forEach((p, i) => {
                const tr = document.createElement('tr');
                let rowClass = "border-b border-gray-700";
                let icon = "";
                let style = "text-gray-300";
                if(p.status === STATUS.ELIMINATED) { rowClass = "row-eliminated"; icon = "üíÄ"; }
                else if(p.status === STATUS.CLEARED) { rowClass = "row-cleared"; icon = "üëë"; style = "text-green-400"; }
                else if(i === currentIndex) { rowClass = "current-turn border-b border-yellow-900"; style = "text-white"; }
                
                tr.className = rowClass;
                let missHtml = "";
                for(let m=0; m<3; m++) missHtml += (m<p.miss) ? "‚ùå" : "‚óè";
                
                tr.innerHTML = `
                    <td class="py-3 pl-3 flex items-center ${style}"><span class="w-5 text-center mr-1">${icon}</span>${p.name}${i===currentIndex && p.status==='playing' ? '<span class="text-xs ml-2 text-yellow-400 animate-pulse">‚óÄ</span>':''}</td>
                    <td class="text-center text-[10px] text-gray-500">${missHtml}</td>
                    <td class="text-right pr-4 font-mono text-xl ${p.status==='cleared'?'text-green-400':'text-white'}">${p.status==='eliminated'?'-':p.score}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- Result & Save ---
        function finishGame() {
            // È†Ü‰ΩçÁ¢∫ÂÆö
            const survivors = players.filter(p => p.status === STATUS.PLAYING);
            let ranking = [...clearOrder, ...survivors, ...eliminatedStack.reverse()];
            
            // „Éá„Éº„Çø‰øùÂ≠ò
            saveRecord(gameLogs);

            // ÁµêÊûúË°®Á§∫
            const list = document.getElementById('result-list');
            list.innerHTML = '';
            ranking.forEach((p, i) => {
                let color = i===0?"text-yellow-400":i===1?"text-gray-300":"text-orange-400";
                list.innerHTML += `<div class="flex justify-between border-b border-gray-700 py-3"><div class="${color} font-bold text-xl w-12">${i+1}th</div><div class="text-white font-bold">${p.name}</div><div class="text-gray-400 font-mono">${p.score}pt</div></div>`;
            });
            showView('view-result');
        }

        function saveRecord(logs) {
            let stored = JSON.parse(localStorage.getItem('molkky_logs') || '[]');
            stored = stored.concat(logs);
            localStorage.setItem('molkky_logs', JSON.stringify(stored));
        }

        // --- Restart Logic (Continuous Play) ---
        function restartGame() {
            // „Çπ„Ç≥„Ç¢„Å®Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„ÄÅÂêå„Åò„É°„É≥„Éê„Éº„ÅßÈñãÂßã
            currentIndex = 0;
            clearOrder = [];
            eliminatedStack = [];
            gameLogs = [];
            
            players.forEach(p => {
                p.score = 0;
                p.miss = 0;
                p.status = STATUS.PLAYING;
            });
            
            switchMode('snipe');
            updateScoreboard();
            showView('view-game');
        }

        // --- Navigation ---
        function goHome(forceFinish = false) {
            if(!forceFinish && document.getElementById('view-game').classList.contains('active-view')) {
                showModal('üè†', '„Éõ„Éº„É†„Å∏Êàª„Çã', 'Ë©¶Âêà„Çí‰∏≠Êñ≠„Åó„Å¶„Çø„Ç§„Éà„É´„Å´Êàª„Çä„Åæ„Åô„ÅãÔºü<br>„Éá„Éº„Çø„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åõ„Çì„ÄÇ', [
                    {text:'„Ç≠„É£„É≥„Çª„É´'}, 
                    {text:'Êàª„Çã', primary:true, onClick:()=>{ showView('view-title'); }}
                ]);
            } else {
                // „Çø„Ç§„Éà„É´„Å´Êàª„Å£„Åü„Çâ„ÄÅ„Éó„É¨„Ç§„É§„ÉºË®≠ÂÆö‰ª•Â§ñ„ÅÆÈÄ≤Ë°å„Éá„Éº„Çø„ÅØ„ÇØ„É™„Ç¢
                showView('view-title');
            }
        }

        // --- Stats View ---
        function goToRecords() {
            showView('view-records');
            const stored = JSON.parse(localStorage.getItem('molkky_logs') || '[]');
            if(stored.length === 0) {
                document.getElementById('no-data-msg').style.display = 'block';
                document.getElementById('stats-container').style.display = 'none';
                return;
            }
            document.getElementById('no-data-msg').style.display = 'none';
            document.getElementById('stats-container').style.display = 'block';

            const names = [...new Set(stored.map(l => l.player))];
            const select = document.getElementById('record-player-select');
            select.innerHTML = '';
            names.forEach(n => select.innerHTML += `<option value="${n}">${n}</option>`);
            
            analyzeRecords();
        }

        function analyzeRecords() {
            const stored = JSON.parse(localStorage.getItem('molkky_logs') || '[]');
            const target = document.getElementById('record-player-select').value;
            const myLogs = stored.filter(l => l.player === target);

            document.getElementById('stat-total-throws').innerText = myLogs.length;
            document.getElementById('stat-wins').innerText = myLogs.filter(l => l.is_finish).length;
            
            const s = myLogs.filter(l => l.mode === 'snipe').length;
            const b = myLogs.filter(l => l.mode === 'break').length;
            const total = s + b || 1;
            const sRate = Math.round(s/total*100);
            
            document.getElementById('text-snipe').innerText = `Snipe ${sRate}%`;
            document.getElementById('text-break').innerText = `Break ${100-sRate}%`;
            document.getElementById('bar-snipe').style.width = `${sRate}%`;
            document.getElementById('bar-break').style.width = `${100-sRate}%`;
        }

        function clearAllData() {
            if(confirm("ÂÖ®Â±•Ê≠¥„ÇíÊ∂àÂéª„Åó„Åæ„Åô„ÅãÔºü")) {
                localStorage.removeItem('molkky_logs');
                goToRecords();
            }
        }

        // --- Modal Helper ---
        function showModal(icon, title, msg, actions) {
            document.getElementById('modal-icon').innerText = icon;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-message').innerHTML = msg;
            const container = document.getElementById('modal-actions');
            container.innerHTML = '';
            actions.forEach(a => {
                const btn = document.createElement('button');
                btn.className = `flex-1 py-3 px-4 rounded-lg font-bold text-sm ${a.primary?'bg-blue-600 text-white':'bg-gray-700 text-gray-300'}`;
                btn.innerText = a.text;
                btn.onclick = () => { closeModal(); if(a.onClick) a.onClick(); };
                container.appendChild(btn);
            });
            document.getElementById('modal-overlay').classList.add('modal-active');
        }
        function closeModal() { document.getElementById('modal-overlay').classList.remove('modal-active'); }
    </script>
</body>
</html>
