<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molkky Log Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a1a; color: #fff; font-family: sans-serif; }
        /* ÂÖ•Âäõ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .btn-numpad { height: 65px; font-size: 1.5rem; font-weight: bold; border-radius: 12px; transition: background 0.1s; }
        .btn-numpad:active { transform: scale(0.95); }
        .hidden-view { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-md bg-gray-900 p-6 rounded-xl shadow-2xl h-[90vh] flex flex-col relative">

        <div id="view-login" class="flex flex-col justify-center h-full space-y-6">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-green-400 mb-2">M√∂lkky Log ü™µ</h1>
                <p class="text-gray-400 text-sm">Authorized Personnel Only</p>
            </div>
            
            <div class="space-y-4">
                <input type="email" id="email" placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ" class="w-full p-4 rounded bg-gray-800 text-white border border-gray-700 focus:border-green-500 outline-none">
                <input type="password" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ" class="w-full p-4 rounded bg-gray-800 text-white border border-gray-700 focus:border-green-500 outline-none">
            </div>

            <button onclick="login()" class="w-full p-4 bg-green-600 hover:bg-green-500 rounded text-white font-bold transition">„É≠„Ç∞„Ç§„É≥</button>
            <p id="login-msg" class="text-red-400 text-center text-sm min-h-[20px]"></p>
        </div>

        <div id="view-game" class="hidden-view flex flex-col h-full">
            <div class="flex justify-between items-end mb-6 pb-4 border-b border-gray-700">
                <div>
                    <div class="text-xs text-gray-500">PLAYER</div>
                    <div id="current-player-name" class="text-xl font-bold text-yellow-400">Player 1</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-500">SCORE</div>
                    <div id="current-score-display" class="text-5xl font-bold font-mono">0</div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-2 mb-4 flex justify-between items-center">
                <span class="text-xs text-gray-400 pl-2">HIT TYPE</span>
                <div class="flex space-x-2">
                    <button id="mode-break" onclick="setMode('break')" class="flex-1 px-4 py-2 rounded bg-blue-600 text-white font-bold text-sm ring-2 ring-white">Ë§áÊï∞ (Break)</button>
                    <button id="mode-snipe" onclick="setMode('snipe')" class="flex-1 px-4 py-2 rounded bg-gray-700 text-gray-400 font-bold text-sm">1Êú¨ (Snipe)</button>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-4 flex-grow content-start">
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(7)">7</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(8)">8</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(9)">9</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(4)">4</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(5)">5</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(6)">6</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(1)">1</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(2)">2</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(3)">3</button>
                
                <button class="btn-numpad bg-red-900/50 text-red-300 border border-red-900 hover:bg-red-900" onclick="inputScore(0)">MISS</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(10)">10</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(11)">11</button>
                <button class="btn-numpad bg-gray-700 hover:bg-gray-600" onclick="inputScore(12)">12</button>
            </div>

            <div class="mt-auto pt-2 border-t border-gray-700">
                <div id="log-display" class="h-16 overflow-y-auto text-xs text-gray-400 font-mono space-y-1">
                    <div class="text-gray-600">-- No Data --</div>
                </div>
                <button onclick="logout()" class="text-xs text-gray-600 underline mt-2 w-full text-center">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
        </div>
    </div>

    <script type="module">
        // ÂøÖË¶Å„Å™Ê©üËÉΩ„ÇíWeb„Åã„ÇâË™≠„ÅøËæº„Åø„Åæ„ÅôÔºà„Ç§„É≥„Çπ„Éà„Éº„É´‰∏çË¶ÅÔºâ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
        // „Åì„Åì„Å´Firebase„ÅÆË®≠ÂÆö„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ
        // „Ç≥„É≥„ÇΩ„Éº„É´„Åß„Ç≥„Éî„Éº„Åó„Åü const firebaseConfig = {...} „Çí„Åù„ÅÆ„Åæ„Åæ‰∏äÊõ∏„Åç„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        const firebaseConfig = {
            apiKey: "„Åì„Åì„Å´API„Ç≠„Éº„ÇíË≤º„Çã",
            authDomain: "xxx.firebaseapp.com",
            projectId: "xxx",
            storageBucket: "xxx.appspot.com",
            messagingSenderId: "xxx",
            appId: "xxx"
        };
        // ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ

        // „Ç¢„Éó„É™„ÅÆÂàùÊúüÂåñ
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // „Ç≤„Éº„É†„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        let currentUser = null;
        let currentScore = 0;
        let isSingleMode = false; // ÂàùÊúüÂÄ§„ÅØ„Éñ„É¨„Ç§„ÇØ(Ë§áÊï∞)

        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        window.login = () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, pass)
                .catch(error => {
                    console.error(error);
                    document.getElementById('login-msg').innerText = "„É≠„Ç∞„Ç§„É≥Â§±Êïó: „É°„Éº„É´„Åã„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô";
                });
        };

        window.logout = () => signOut(auth);

        // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÅÆÁõ£Ë¶ñÔºàÁîªÈù¢Âàá„ÇäÊõø„ÅàÔºâ
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('view-login').classList.add('hidden-view');
                document.getElementById('view-game').classList.remove('hidden-view');
            } else {
                currentUser = null;
                document.getElementById('view-login').classList.remove('hidden-view');
                document.getElementById('view-game').classList.add('hidden-view');
            }
        });

        // „É¢„Éº„ÉâÂàáÊõøÔºà1Êú¨Êâì„Å° vs Ë§áÊï∞Ôºâ
        window.setMode = (mode) => {
            const btnBreak = document.getElementById('mode-break');
            const btnSnipe = document.getElementById('mode-snipe');
            
            if (mode === 'snipe') {
                isSingleMode = true;
                // Snipe ON
                btnSnipe.className = "flex-1 px-4 py-2 rounded bg-green-600 text-white font-bold text-sm ring-2 ring-white";
                // Break OFF
                btnBreak.className = "flex-1 px-4 py-2 rounded bg-gray-700 text-gray-400 font-bold text-sm";
            } else {
                isSingleMode = false;
                // Break ON
                btnBreak.className = "flex-1 px-4 py-2 rounded bg-blue-600 text-white font-bold text-sm ring-2 ring-white";
                // Snipe OFF
                btnSnipe.className = "flex-1 px-4 py-2 rounded bg-gray-700 text-gray-400 font-bold text-sm";
            }
        };

        // „Çπ„Ç≥„Ç¢ÂÖ•ÂäõÂá¶ÁêÜ
        window.inputScore = async (points) => {
            if (!currentUser) return;

            const scoreBefore = currentScore;
            let nextScore = currentScore + points;

            // „É´„Éº„É´Âà§ÂÆö
            if (nextScore === 50) {
                alert("üéâ 50ÁÇπ„ÇØ„É™„Ç¢ÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ");
                nextScore = 0; // Ê¨°„ÅÆ„Ç≤„Éº„É†„Å∏ÔºàÁ∞°Êòì„É™„Çª„ÉÉ„ÉàÔºâ
            } else if (nextScore > 50) {
                // 50ÁÇπ„Ç™„Éº„Éê„Éº„Åß25ÁÇπ„Å∏
                nextScore = 25; 
            }

            // ÁîªÈù¢Êõ¥Êñ∞
            currentScore = nextScore;
            document.getElementById('current-score-display').innerText = currentScore;

            // „É≠„Ç∞„ÅÆÊõ¥Êñ∞
            const type = points === 0 ? "MISS" : (isSingleMode ? "SNIPE" : "BREAK");
            const logHTML = `<div class="border-b border-gray-800 pb-1">
                <span class="text-green-400">${points}pt</span> <span class="text-gray-500 text-[10px]">${type}</span> 
                <span class="text-gray-600">(${scoreBefore}‚Üí${nextScore})</span>
            </div>`;
            const logDiv = document.getElementById('log-display');
            logDiv.innerHTML = logHTML + logDiv.innerHTML;

            // „Éá„Éº„Çø„Éô„Éº„Çπ‰øùÂ≠ò
            try {
                await addDoc(collection(db, "game_logs"), {
                    uid: currentUser.uid,
                    user_email: currentUser.email,
                    score_scored: points,
                    score_before: scoreBefore,
                    is_single: isSingleMode,
                    is_miss: points === 0,
                    timestamp: serverTimestamp()
                });
            } catch (e) {
                console.error("‰øùÂ≠ò„Ç®„É©„Éº:", e);
                alert("„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            }
        };
    </script>
</body>
</html>
